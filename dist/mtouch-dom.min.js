!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).mTouch=e()}(this,function(){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function f(){}var t=navigator.userAgent,D={tapMaxDistance:5,doubleTapDelay:200,longTapDelay:700,swipeMinDistance:5,swipeTime:300,lockDirection:!0},E={hasTouch:!!("ontouchstart"in window&&{ios:function(){return t.match(/\((i[^;]+);.+OS\s([\d_.]+)/)},android:function(){return t.match(/(Android)[\s/]+([\d.]+)/)},wp:function(){return t.match(/(Windows\s+Phone)\s([\d.]+)/)},getMobile:function(){return this.ios||this.android||this.wp}}.getMobile()),isProxyTarget:function(t,e){return 0===e.indexOf(".")?new RegExp("(\\s|^)".concat(e.substring(1),"(\\s|$)")).test(t.className):0===e.indexOf("#")?t.id===e.substring(1):t.tagName.toLocaleLowerCase()===e},swipeDirection:function(t,e,n,i,o){return D.lockDirection&&"horizontal"===o||!D.lockDirection&&Math.abs(t-n)>=Math.abs(e-i)?n<t?"LEFT":"RIGHT":i<e?"UP":"DOWN"},_trigger:function(t,e,n){var i=n.target,o=e||n.currentTarget||n.target;if(i&&o._m_touch_events[t])for(var a=o._m_touch_events[t];;){if(!i)return;if(i===o)return void this._execHandler(a,t,i,n,!0);var r=a;if(!1===(a=this._execHandler(r,t,i,n,!1)))return;i=i.parentNode}},_execHandler:function(t,e,n,i,o){var a,r,c,u,s,h=[],_=[];for(a=0,r=t.length;a<r;a++)u=(c=t[a]).proxyStr||"",o?u||h.push(c):u&&this.isProxyTarget(n,u)?h.push(c):_.push(c);if(h.length)for(a=0,r=h.length;a<r;a++)if(s=h[a].handler||f,!1===this._callback(e,s,n,i))return!1;return _},_callback:function(t,e,n,i){var o=this.hasTouch?i.touches.length?i.touches[0]:i.changedTouches[0]:i,a=i._m_touch_data||{},r=a.startX||0,c=a.startY||0,u=o.pageX||0,s=o.pageY||0,h={type:t,target:i.target,startX:r,startY:c,pageX:u,pageY:s,moveX:u-r,moveY:s-c,startTime:a.touchStartTime||0,direction:i._m_touch_data?i._m_touch_data.directionLocked:""};i.mTouchEvent=h;var _=e.call(n,i);return!1===_&&(i.preventDefault(),i.stopPropagation()),_},stopFilter:function(e){return function(t){return t.stopPropagation(),e.call(this,t)}},preventFilter:function(e){return function(t){return t.preventDefault(),e.call(this,t)}}},w={TOUCH_START:E.hasTouch?"touchstart":"mousedown",TOUCH_MOVE:E.hasTouch?"touchmove":"mousemove",TOUCH_END:E.hasTouch?"touchend":"mouseup",TOUCH_CANCEL:"touchcancel",TAP:"tap",DOUBLE_TAP:"doubletap",LONG_TAP:"longtap",SWIPE_START:"swipestart",SWIPING:"swiping",SWIPE_END:"swipeend",SWIPE_LEFT:"swipeleft",SWIPE_RIGHT:"swiperight",SWIPE_UP:"swipeup",SWIPE_DOWN:"swipedown",CANCEL:"cancel"};var n=function(){function e(t){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),[].forEach.call(t,function(t,e){t._m_touch_events=t._m_touch_events||{},function(c){if(!c._m_touch_is_bind){var r,n,u,s=0,h=0,t=[],_=t[0],f=t[1],l=t[2],p=t[3],d=!1,g="",T=function(){clearTimeout(r),clearTimeout(n)},m=function(t){d=!1,T(),E._trigger(w.TAP,c,t)},v=function(t){T(),t._m_touch_data={startX:_,startY:l,touchStartTime:s,directionLocked:u},E._trigger(w.CANCEL,c,t)};c.addEventListener(w.TOUCH_START,function(t){var e=E.hasTouch?t.touches[0]:t;_=e.pageX,l=e.pageY,d=!(p=f=0),s=Date.now(),g=u="",t._m_touch_data={startX:_,startY:l,touchStartTime:s,directionLocked:""},E._trigger(w.SWIPE_START,c,t),clearTimeout(n),n=setTimeout(function(){d=!1,T(),E._trigger(w.LONG_TAP,c,t)},D.longTapDelay)}),c.addEventListener(w.TOUCH_MOVE,function(t){if(d){var e=Date.now(),n=E.hasTouch?t.touches[0]:t,i=f||n.pageX,o=p||n.pageY;t._m_touch_data={startX:_,startY:l,touchStartTime:s,directionLocked:""},f=n.pageX,p=n.pageY;var a=Math.abs(_-f),r=Math.abs(l-p);a<D.tapMaxDistance&&r<D.tapMaxDistance||(D.lockDirection&&!u&&(u=r<a?"horizontal":"vertical"),g=E.swipeDirection(i,o,f,p,u),t._m_touch_data.directionLocked=u,T(),E._trigger(w.SWIPING,c,t),300<e-s&&(s=e,t._m_touch_data.touchStartTime=s))}}),c.addEventListener(w.TOUCH_END,function(t){if(d){var e=Date.now(),n=E.hasTouch?t.changedTouches[0]:t;f=n.pageX,p=n.pageY,t._m_touch_data={startX:_,startY:l,touchStartTime:s,directionLocked:u},E._trigger(w.SWIPE_END,c,t);var i=Math.abs(_-f),o=Math.abs(l-p);if(i<=D.tapMaxDistance&&o<=D.tapMaxDistance)h=c._m_touch_events[w.DOUBLE_TAP]&&c._m_touch_events[w.DOUBLE_TAP].length?e-h>D.doubleTapDelay?(r=setTimeout(function(){m(t)},D.doubleTapDelay),e):(T(),E._trigger(w.DOUBLE_TAP,c,t),0):(m(t),e);else if(e-s<=D.swipeTime&&(i>D.swipeMinDistance||o>D.swipeMinDistance)){var a=E.swipeDirection(_,l,f,p,u);T(),a===g?E._trigger(w["SWIPE_".concat(g)],c,t):v(t)}else v(t);d=!1}}),c.addEventListener(w.TOUCH_CANCEL,v),c._m_touch_is_bind=!0}}(t),n[e]=t}),this.length=t.length}return function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(e,[{key:"each",value:function(t){for(var e=0,n=this.length;e<n;e++)t.call(this[e],e);return this}},{key:"on",value:function(t,n,i){if("function"==typeof n&&(i=n,n=null),"function"!=typeof i||!t||!t.length)return this;var o=t.split(/\s+/);return this.each(function(){var e=this._m_touch_events;o.forEach(function(t){e[t]||(e[t]=[]),e[t].push({handler:i,proxyStr:n})})}),this}},{key:"off",value:function(o,a,r){return"function"==typeof a&&(r=a,a=null),this.each(function(){var t=this._m_touch_events;if(o){if(t[o]&&t[o].length)if(a||r)for(var e,n=t[o],i=n.length-1;0<=i;)e=n[i],a&&"function"==typeof r?e.proxyStr===a&&e.handler===r&&n.splice(i,1):a&&e.proxyStr===a?n.splice(i,1):"function"==typeof r&&e.handler===r&&n.splice(i,1),i-=1;else t[o]=[]}else this._m_touch_events={}}),this}}],[{key:"config",value:function(t){Object.assign(D,t)}}]),e}();function e(t){var e;return e=t===document||1===t.nodeType?[t]:document.querySelectorAll(t),new n(e)}return e.config=n.config,e});
